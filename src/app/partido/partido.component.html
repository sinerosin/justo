<ion-split-pane contentId="main-content">
  <ion-menu contentId="main-content" type="overlay">
    <ion-content class="sidebar-content">
      <div class="brand-section">
        <ion-icon name="cube" color="danger"></ion-icon>
        <div>
          <h3>BetStars</h3>
          <p>GANA CON PASIÓN</p>
        </div>
      </div>
      <ion-list lines="none" class="menu-list">
        <ion-item button (click)="navigateTo('/home')">
          <ion-icon slot="start" name="grid-outline"></ion-icon>
          <ion-label>Panel</ion-label>
        </ion-item>
        <ion-item button (click)="navigateTo('/liga')" >
          <ion-icon slot="start" name="trophy-outline"></ion-icon>
          <ion-label>Liga</ion-label>
        </ion-item>
        <ion-item button (click)="navigateTo('/ranking')">
          <ion-icon slot="start" name="stats-chart-outline"></ion-icon>
          <ion-label>Ranking</ion-label>
        </ion-item>
        <ion-item button (click)="navigateTo('/perfil')">
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label>Mi Perfil</ion-label>
        </ion-item>
        <ion-item button (click)="navigateTo('/historial')" [class.active-item]="router.url.includes('historial')">
          <ion-icon slot="start" name="time-outline"></ion-icon>
          <ion-label>Historial</ion-label>
        </ion-item>
      </ion-list>
      <div class="sidebar-footer">
        <ion-item lines="none" class="user-item">
          <ion-avatar slot="start"><img [src]="currentUser.profPicture" /></ion-avatar>
          <ion-label>{{ currentUser.username }}</ion-label>
        </ion-item>
        <ion-button expand="block" fill="clear" color="danger" (click)="logout()">
          <ion-icon slot="start" name="log-out-outline"></ion-icon>Cerrar Sesión
        </ion-button>
      </div>
    </ion-content>
  </ion-menu>

  <div class="ion-page" id="main-content">
    <ion-header class="ion-no-border">
      <ion-toolbar color="black">
        <ion-buttons slot="start"><ion-back-button defaultHref="/home" color="danger"></ion-back-button></ion-buttons>
        <ion-title>Detalles del Partido</ion-title>
        <ion-badge slot="end" color="danger" class="pts-header">{{ currentUser.points }} PTS</ion-badge>
      </ion-toolbar>
    </ion-header>

    <ion-content class="dark-theme" *ngIf="game">
      <div class="match-details-centered">
        
        <ion-card class="scoreboard-card">
          <div class="team-block">
            <img [src]="getEscudo(game.home)" />
            <h3>{{ game.home }}</h3>
            <ion-badge color="danger">LOCAL</ion-badge>
          </div>
          
          <div class="score-display">
            <span class="score" *ngIf="game.status !== 'pending'">{{ game.homeScore }} - {{ game.awayScore }}</span>
            <span class="vs" *ngIf="game.status === 'pending'">VS</span>
            
            <div class="status-info">
              <small *ngIf="game.status === 'live'" class="live-blink">EN VIVO {{ game.minute }}'</small>
              <small *ngIf="game.status === 'finished'">FINALIZADO</small>
              <small class="match-time">{{ game.time }}</small>
            </div>
          </div>

          <div class="team-block">
            <img [src]="getEscudo(game.away)" />
            <h3>{{ game.away }}</h3>
            <ion-badge color="medium">VISITANTE</ion-badge>
          </div>
        </ion-card>

        <ion-card class="betting-card" *ngIf="game.status === 'pending'">
          <div class="card-header">
            <ion-icon name="cash-outline" color="danger"></ion-icon>
            <h3>Realiza tu Pronóstico</h3>
          </div>
          <ion-card-content>
            <div class="bet-inputs">
              <div class="input-box">
                <ion-label>{{ game.home }}</ion-label>
                <ion-input type="number" [(ngModel)]="betData.home"></ion-input>
              </div>
              <span class="separator">-</span>
              <div class="input-box">
                <ion-label>{{ game.away }}</ion-label>
                <ion-input type="number" [(ngModel)]="betData.away"></ion-input>
              </div>
            </div>
            <p class="bet-hint">Acierto exacto: +10 pts | Ganador: +5 pts</p>
            <ion-button expand="block" color="danger" (click)="enviarApuesta()" [disabled]="saveBet">
              <ion-spinner name="crescent" *ngIf="saveBet"></ion-spinner>
              <span *ngIf="!saveBet">CONFIRMAR APUESTA</span>
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-card class="content-card" *ngIf="game.status !== 'pending'">
          <div class="card-header"><h3>Eventos del Partido</h3></div>
          <ion-list lines="full">
            <ion-item *ngFor="let event of game.events">
              <ion-avatar slot="start"><ion-icon name="person-circle" color="light"></ion-icon></ion-avatar>
              <ion-label>
                <h2>{{ event.player }}</h2>
                <p><ion-icon name="football" color="success"></ion-icon> {{ event.team }} - ¡GOL!</p>
              </ion-label>
              <div slot="end" class="event-meta">
                <ion-badge color="danger">{{ event.minute }}'</ion-badge>
                <span class="partial-score">{{ event.score }}</span>
              </div>
            </ion-item>
          </ion-list>
        </ion-card>

        <ion-card class="content-card">
          <div class="card-header"><h3>Clasificación en Vivo</h3><ion-badge color="danger">LA LIGA</ion-badge></div>
          <div class="table-responsive">
            <table class="mini-table">
              <thead><tr><th>POS</th><th>EQUIPO</th><th>PJ</th><th>PTS</th></tr></thead>
              <tbody>
                <tr *ngFor="let team of standings; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="team-name" [class.highlight]="team.name === game.home || team.name === game.away">
                    {{ team.name }}
                  </td>
                  <td>{{ team.pj }}</td>
                  <td class="bold">{{ team.pts }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </ion-card>
      </div>
    </ion-content>
  </div>
</ion-split-pane>